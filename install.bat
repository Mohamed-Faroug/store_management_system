@echo off
chcp 65001 >nul
title ูุธุงู ุฅุฏุงุฑุฉ ุงููุฎุฒูู - ุงูุชุซุจูุช

echo.
echo โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
echo โโ                                                            โโ
echo โโ  ๐ช ูุธุงู ุฅุฏุงุฑุฉ ุงููุฎุฒูู - ูุฎุฒู ุงูุฒููุฉ                      โโ
echo โโ  ๐จโ๐ป ุชู ุชุทููุฑ ูุฐุง ุงููุธุงู ุจูุงุณุทุฉ: ูุญูุฏ ูุงุฑูู              โโ
echo โโ  ๐ ุชุงุฑูุฎ ุขุฎุฑ ุชุญุฏูุซ: 9/9/2025                            โโ
echo โโ  ยฉ ุฌููุน ุงูุญููู ูุญููุธุฉ 2025                                โโ
echo โโ                                                            โโ
echo โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
echo.

echo ๐ง ุจุฏุก ุนูููุฉ ุงูุชุซุจูุช...
echo.

:: ูุญุต ูุฌูุฏ Python
echo ๐ ูุญุต Python...
python --version >nul 2>&1
if errorlevel 1 (
    echo โ Python ุบูุฑ ูุซุจุช!
    echo.
    echo ๐ฅ ูุฑุฌู ุชุซุจูุช Python ูู: https://python.org
    echo ๐ ุชุฃูุฏ ูู ุชุญุฏูุฏ "Add Python to PATH" ุฃุซูุงุก ุงูุชุซุจูุช
    pause
    exit /b 1
) else (
    echo โ Python ูุซุจุช
)

:: ุฅูุดุงุก ุงููุฌูุฏุงุช ุงููุทููุจุฉ
echo.
echo ๐ ุฅูุดุงุก ุงููุฌูุฏุงุช ุงููุทููุจุฉ...
mkdir logs 2>nul
mkdir backups 2>nul
mkdir temp 2>nul
mkdir uploads 2>nul
mkdir data 2>nul
echo โ ุชู ุฅูุดุงุก ุงููุฌูุฏุงุช

:: ุชุซุจูุช ุงููุชุทูุจุงุช
echo.
echo ๐ฆ ุชุซุจูุช ุงููุชุทูุจุงุช...
pip install -r requirements.txt
if errorlevel 1 (
    echo โ ูุดู ูู ุชุซุจูุช ุงููุชุทูุจุงุช
    pause
    exit /b 1
) else (
    echo โ ุชู ุชุซุจูุช ุงููุชุทูุจุงุช ุจูุฌุงุญ
)

:: ุฅูุดุงุก ูุงุนุฏุฉ ุงูุจูุงูุงุช
echo.
echo ๐๏ธ ุฅูุดุงุก ูุงุนุฏุฉ ุงูุจูุงูุงุช...
python -c "from app import create_app; from app.models.database import init_db; app = create_app(); app.app_context().push(); init_db()"
if errorlevel 1 (
    echo โ ูุดู ูู ุฅูุดุงุก ูุงุนุฏุฉ ุงูุจูุงูุงุช
    pause
    exit /b 1
) else (
    echo โ ุชู ุฅูุดุงุก ูุงุนุฏุฉ ุงูุจูุงูุงุช ุจูุฌุงุญ
)

:: ุฅูุดุงุก ููู ุชุดุบูู
echo.
echo ๐ ุฅูุดุงุก ููู ุงูุชุดุบูู...
echo @echo off > start.bat
echo chcp 65001 ^>nul >> start.bat
echo title ูุธุงู ุฅุฏุงุฑุฉ ุงููุฎุฒูู >> start.bat
echo echo ๐ ุชุดุบูู ูุธุงู ุฅุฏุงุฑุฉ ุงููุฎุฒูู... >> start.bat
echo python main.py >> start.bat
echo pause >> start.bat
echo โ ุชู ุฅูุดุงุก ููู ุงูุชุดุบูู

:: ุฅูุดุงุก ุงุฎุชุตุงุฑ ุณุทุญ ุงูููุชุจ
echo.
echo ๐ฅ๏ธ ุฅูุดุงุก ุงุฎุชุตุงุฑ ุณุทุญ ุงูููุชุจ...
set "desktop=%USERPROFILE%\Desktop"
set "current_dir=%CD%"
echo [InternetShortcut] > "%desktop%\ูุธุงู ุฅุฏุงุฑุฉ ุงููุฎุฒูู.url"
echo URL=file:///%current_dir%\start.bat >> "%desktop%\ูุธุงู ุฅุฏุงุฑุฉ ุงููุฎุฒูู.url"
echo IconFile=%current_dir%\start.bat >> "%desktop%\ูุธุงู ุฅุฏุงุฑุฉ ุงููุฎุฒูู.url"
echo IconIndex=0 >> "%desktop%\ูุธุงู ุฅุฏุงุฑุฉ ุงููุฎุฒูู.url"
echo โ ุชู ุฅูุดุงุก ุงุฎุชุตุงุฑ ุณุทุญ ุงูููุชุจ

:: ุนุฑุถ ูุนูููุงุช ุงูุชุซุจูุช
echo.
echo โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
echo โโ                    ุชู ุงูุชุซุจูุช ุจูุฌุงุญ!                      โโ
echo โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
echo.
echo ๐ฑ ูููุตูู ููุชุทุจูู:
echo    ๐ ุงูุชุญ ุงููุชุตูุญ ูุงุฐูุจ ุฅูู: http://127.0.0.1:8080
echo.
echo ๐ ุจูุงูุงุช ุงูุฏุฎูู ุงูุงูุชุฑุงุถูุฉ:
echo    ๐ค ุงููุฏูุฑ: admin / admin123
echo    ๐ค ุงููุงุดูุฑ: cashier / cashier123
echo.
echo ๐ ุทุฑู ุงูุชุดุบูู:
echo    ๐ ุงููุฑ ูุฑุชูู ุนูู: start.bat
echo    ๐ฅ๏ธ ุฃู ูู ุงุฎุชุตุงุฑ ุณุทุญ ุงูููุชุจ
echo.
echo โ๏ธ  ูุตุงุฆุญ ูููุฉ:
echo    ๐ ุบููุฑ ูููุงุช ุงููุฑูุฑ ุงูุงูุชุฑุงุถูุฉ
echo    ๐พ ุงุญุชูุธ ุจูุณุฎ ุงุญุชูุงุทูุฉ ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช
echo    ๐ ุดุบูู ุงูุชุญุฏูุซุงุช ุจุงูุชุธุงู
echo.

:: ุณุคุงู ุงููุณุชุฎุฏู
set /p choice="ูู ุชุฑูุฏ ุชุดุบูู ุงูุชุทุจูู ุงูุขูุ (y/n): "
if /i "%choice%"=="y" (
    echo.
    echo ๐ ุชุดุบูู ุงูุชุทุจูู...
    start.bat
) else (
    echo.
    echo ๐ ุดูุฑุงู ูุงุณุชุฎุฏุงู ูุธุงู ุฅุฏุงุฑุฉ ุงููุฎุฒูู
    echo ๐ฑ ููููู ุชุดุบูู ุงูุชุทุจูู ูุงุญูุงู ูู ููู start.bat
)

echo.
pause
